name: Export Godot

on:
  push:
    tags: [ 'v*' ]

jobs:
  export:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Godot
      uses: chickensoft-games/setup-godot@v1
      with:
        version: 4.3.0
        use-dotnet: true
        
    - name: Verify Project
      run: |
        cd client-godot
        godot --headless --check-only --quit
        
    - name: Export Linux
      run: |
        cd client-godot
        mkdir -p exports/linux
        godot --headless --export-release "Linux/X11" exports/linux/space-station-sim
        
    - name: Export Windows
      run: |
        cd client-godot
        mkdir -p exports/windows
        godot --headless --export-release "Windows Desktop" exports/windows/space-station-sim.exe
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: exports
        path: client-godot/exports/